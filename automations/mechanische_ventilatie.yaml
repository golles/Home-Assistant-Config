- id: mechanische_ventilatie_douchen
  alias: Mechanische ventilatie tijdens douchen
  initial_state: on
  mode: restart
  trigger:
    - platform: homeassistant
      event: start # Listen to start event to make sure we're not staying forever in high mode.
    - platform: state
      entity_id: binary_sensor.douche_beweging_occupancy
      from: "off"
      to: "on"
    - platform: state
      entity_id: binary_sensor.douche_beweging_occupancy
      from: "on"
      to: "off"
      for:
        minutes: 5
  action:
    - choose:
      - conditions:
        - "{{ trigger.entity_id == 'binary_sensor.douche_beweging_occupancy' }}"
        - "{{ is_state('binary_sensor.douche_beweging_occupancy', 'on') }}"
        sequence:
          - alias: Occupancy detected
            service: script.ventilation_set_preset_mode
            data:
              preset_mode: high

      - conditions:
        - "{{ trigger.entity_id == 'binary_sensor.douche_beweging_occupancy' }}"
        - "{{ is_state('binary_sensor.douche_beweging_occupancy', 'off') }}"
        sequence:
          - alias: Occupancy no longer detected. First go to low and then set a timer
            service: script.ventilation_set_preset_mode
            data:
              preset_mode: low

          - delay:
              seconds: 5

          - service: script.ventilation_set_speed_timer
            data:
              speed: high
              timer: 10

      # HA start.
      default:
        - service: script.ventilation_set_preset_mode
          data:
            preset_mode: low


- id: nrf905_unavailable_reboot
  alias: nrf905 opnieuw starten wanneer onbeschikbaar
  initial_state: on
  mode: restart
  trigger:
    - platform: state
      entity_id: media_player.your_monitor_chromecast
      to: "unavailable"
      for:
        minutes: 15
  action:
    - service: switch.turn_off
      entity_id: switch.zolder_switch
    - delay:
        minutes: 1
    - service: switch.turn_off
      entity_id: switch.zolder_switch
