- id: keuken_rolgordijn_auto
  alias: Keuken rolgordijn automatisch open/dicht
  mode: single
  max_exceeded: silent
  triggers:
    - alias: Close at sunset
      trigger: time
      at: sensor.sun_next_setting
    - alias: Earliest close time
      trigger: time
      at: "17:00:00"
    - alias: Latest close time
      trigger: time
      at: "19:30:00"
    - alias: Time to open the cover
      trigger: time
      at: "08:30:00"
      id: open
  actions:
    - choose:
        - conditions:
            - condition: trigger
              id: open
          sequence:
            - alias: Randomize time to open
              delay:
                minutes: "{{ range(0, 30) | random }}"
            - alias: Open the cover
              action: button.press
              target:
                entity_id: button.keuken_rolgordijn_voorkeurspositie

        - conditions:
            - condition: time
              after: "17:00:00"
              before: "19:30:01"
          sequence:
            - alias: Randomize time to close
              delay:
                minutes: "{{ range(0, 30) | random }}"
            - alias: Close the cover, depending on the window state
              action: script.close_cover_window_state
              data:
                wait_minutes: 240
                cover_entity: cover.keuken
                window_entity: binary_sensor.keukenraam_contact
