- id: doorbell_press_action
  alias: Deurbel wordt ingedrukt
  description: |
    Wanneer er op de deurbel gedrukt wordt:
      - Stuur een melding naar Sander wanneer de werk laptop deze thuis en actief is.
      - Stuur een melding naar de tv wanneer deze aan staat.
      - Pauzeer de tv als Netflix, Plex of Youtube aan staat.
      - Pauzeer Ziggo wanneer je geen lineaire tv kijkt.
  initial_state: on
  mode: single
  trigger:
    - platform: state
      entity_id: binary_sensor.deurbel_doorbell_pressed
      from: "off"
      to: "on"
  action:
    - variables:
        message_title: Ding dong!
        message_text: Iemand staat bij de deur

    - choose:
      - conditions:
          - "{{ is_state('device_tracker.tt_macbook', 'home') }}"
          - "{{ is_state('binary_sensor.tt_macbook_active', 'on') }}"
        sequence:
          - alias: Notify work laptop when working from home
            service: notify.sander
            data:
              title: "{{ message_title }}"
              message: "{{ message_text }}"
              data:
                group: deurbel
                entity_id: camera.deurbel
                url: /dashboard-buiten/buurt

    - choose:
      - conditions:
        - "{{ is_state('media_player.lg_c9', 'on') }}"
        sequence:
        - alias: Nottify tv when on
          service: notify.lg_c9
          data:
            message: "{{ message_title }} {{ message_text }}"
        
    - choose:
      - conditions:
          - "{{ state_attr('media_player.lg_c9', 'source') in ['Netflix', 'Plex', 'YouTube'] }}"
        sequence:
          - alias: Pause tv when Netflix, Plex or Youtube is active
            service: media_player.media_pause
            entity_id: media_player.lg_c9
  
      - conditions:
          - "{{ is_state_attr('media_player.lg_c9', 'source', 'Ziggo') }}"
          - "{{ not is_state_attr('media_player.mediabox', 'play_mode', 'linear') }}"
        sequence: 
          - alias: Pause Ziggo, but not when watching linear tv
            service: media_player.media_pause
            entity_id: media_player.mediabox

    # Don't trigger again for a few seconds.
    - delay:
        seconds: 5

- id: eufy-ha-mqtt-bridge_offline
  alias: eufy-ha-mqtt-bridge offline
  description: Ping a message when the container seems to be offline.
  initial_state: on
  mode: single
  trigger:
    - platform: state
      entity_id: binary_sensor.deurbel_doorbell_pressed
      to: unavailable
      for:
        minutes: 2
  action:
    - service: notify.sander
      data:
        title: eufy-ha-mqtt-bridge offline
        message: Check de logs en container moet opnieuw worden gestart.
