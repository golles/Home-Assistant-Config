- id: goedemorgen_bericht
  alias: Goedemorgen bericht bij 1e beweging in de woonkamer
  initial_state: on
  mode: single
  trigger:
    - platform: state
      entity_id: group.woonkamer_motion
      to: 'on'
  condition:
    - condition: state
      entity_id: media_player.lg_c9
      state: 'off' 
    - condition: state
      entity_id: media_player.lg_soundbar
      state: 'off' 
    - condition: state
      entity_id: sensor.day_or_night
      state: Day # Between 00-12.
    - condition: state
      entity_id: sensor.time_of_day
      state: Morning # Between 06-18.
    - condition: template
      value_template: > # Don't trigger if it has been triggered in the lasy 6 hours.
        {{ as_timestamp(now()) - as_timestamp(state_attr('automation.goedemorgen_bericht_bij_1e_beweging_in_de_woonkamer', 'last_triggered')) | int >= 6 * 60 * 60 }}
  action:
    - service: media_player.turn_on
      data:
        entity_id: media_player.lg_soundbar

    - service: media_player.volume_set
      data:
        entity_id: media_player.lg_soundbar
        volume_level: 0.25 # 10 * 0.025

    - wait_template: >
        {{ states('media_player.lg_soundbar') in ['idle', 'on'] }}
      timeout: '00:00:05'
      continue_on_timeout: true

    - service: tts.microsoft_say
      entity_id: media_player.lg_soundbar
      data:
        message: >
          {% set good = ["Goedenacht", "Goedemorgen","Goedemiddag", "Goedeavond"] %}
          {% set days = ["maandag", "dinsdag", "woensdag", "donderdag", "vrijdag", "zaterdag", "zondag"] %}
          {% set months = ["januari", "februari", "maart", "april", "mei", "juni", "juli", "augustus", "september", "oktober", "november", "december"] %}
          
          {{ good[(now().hour / 6) | int] }}!
          Vandaag is het {{ days[now().weekday()] }} {{ now().day }} {{ months[now().month - 1] }}.
          Buiten is het {{ state_attr('sensor.knmi_weer', 'temp') | round }} graden, 
          de temperatuur vandaag is tussen de {{ state_attr('sensor.knmi_weer', 'd0tmax') | round }} en {{ state_attr('sensor.knmi_weer', 'd0tmin') | round }} graden
          het is {{ state_attr('sensor.knmi_weer', 'verw') }}
