- id: auto_light_woonkamer
  alias: Automatisch licht aan in de woonkamer
  initial_state: on
  mode: single
  max_exceeded: silent
  trigger:
    - platform: numeric_state
      entity_id: sensor.woonkamer_lichtsterkte_illuminance_lux
      below: 15
      for:
        minutes: 5
    - platform: state
      entity_id: group.woonkamer_occupancy
      to: "on"
  condition:
    - condition: numeric_state
      entity_id: sensor.woonkamer_lichtsterkte_illuminance_lux
      below: 15
    - condition: state
      entity_id: group.woonkamer_occupancy
      state: "on"
  action:
    - choose:
      - conditions:
        - condition: or
          conditions:
            - condition: state
              entity_id: binary_sensor.morning
              state: "on"
            - condition: state
              entity_id: binary_sensor.night
              state: "on"
        sequence:
          - alias: Turn on the morning or night scene
            service: scene.turn_on
            target:
              entity_id: >-
                {%- if is_state("binary_sensor.night", "on") %}
                  scene.nacht
                {%- else -%}
                  scene.ochtend
                {%- endif %}
            data:
              transition: 2

          - alias: Wait untill there is no more occupancy
            wait_for_trigger:
              platform: state
              entity_id: group.woonkamer_occupancy
              from: "on"
              to: "off"
              for: 30

          - alias: Turn off all lights in the living room
            service: light.turn_off
            target:
              entity_id:
                - light.woonkamer
                - light.eettafel
                - light.keuken
            data:
              transition: 10

      default:
        - alias: Turn on the evening scene
          service: scene.turn_on
          target:
            entity_id: scene.avond
          data:
            transition: 900 # 15 minutes.

- id: auto_light_woonkamer_when_someone_arrives_home
  alias: Automatisch licht aan in de woonkamer wanneer iemand thuis komt
  initial_state: on
  mode: single
  max_exceeded: silent
  trigger:
    - platform: state
      entity_id: group.residents
      from: not_home
      to: home
  condition:
    - condition: numeric_state
      entity_id: sensor.woonkamer_lichtsterkte_illuminance_lux
      below: 15
  action:
    - alias: Turn on the evening scene
      service: scene.turn_on
      target:
        entity_id: scene.avond
      data:
        transition: 900 # 15 minutes.

- id: tv_lights_based_on_source
  alias: TV verlichting aanpassen op basis van de bron
  initial_state: on
  mode: single
  max_exceeded: silent
  trigger:
    - platform: numeric_state
      entity_id: sensor.woonkamer_lichtsterkte_illuminance_lux
      below: 10
      for:
        minutes: 5
    - platform: state
      entity_id: media_player.lg_c9
      attribute: source
      to:
        - Netflix
        - Plex
  condition:
    - condition: numeric_state
      entity_id: sensor.woonkamer_lichtsterkte_illuminance_lux
      below: 10
    - condition: state
      entity_id: media_player.lg_c9
      state: "on" 
    - condition: state
      entity_id: media_player.lg_c9
      attribute: source
      state:
        - Netflix
        - Plex
  action:
    service: scene.turn_on
    data:
      entity_id: scene.film
      transition: 2
