type: custom:auto-entities
show_empty: false
card:
  type: grid
  title: Let op
card_param: cards
filter:
  template: >-
    {%- set data = namespace(entities=[]) -%}

    {% if state_attr("sensor.p2000_dichtbij", "time") %}
      {% if as_timestamp(now()) <= as_timestamp(state_attr("sensor.p2000_dichtbij", "time")) + 7200 %}
        {%- set data.entities = data.entities + [{
          "type": "button",
          "entity": "sensor.p2000_dichtbij",
          "show_state": "true",
          "show_name": "false"
        }] -%}
      {% endif %}
    {% endif %}
    
    {% if is_state("binary_sensor.zonnescherm_contact_contact", "on") %}
      {%- set data.entities = data.entities + [{
        "type": "custom:button-card",
        "template": "zonnescherm"
      }] -%}
    {% endif %}

    {% if not states("sensor.wasmachine_remaining_relative_local") in ["unavailable", "Klaar"] %}
      {%- set data.entities = data.entities + [{
        "type": "button",
        "entity": "sensor.wasmachine_remaining_relative_local",
        "name": "Wasmachine",
        "icon": "mdi:washing-machine",
        "show_state": "true"
      }] -%}
    {% endif %}

    {% if not states("sensor.vaatwasser_remaining_relative_local") in ["unavailable", "Klaar"] %}
      {%- set data.entities = data.entities + [{
        "type": "button",
        "entity": "sensor.vaatwasser_remaining_relative_local",
        "name": "Vaatwasser",
        "icon": "mdi:dishwasher",
        "show_state": "true"
      }] -%}
    {% endif %}
    
    {% if data.entities | length > 0 %}
      {{ data.entities }}
    {% endif %}
  include:
    - domain: sensor
      attributes:
        Wastecollector: purmerend
        Days-until: <= 1
      options:
        type: custom:button-card
        template: afvalbeheer
      not:
        state: unknown

    - attributes:
        device_class: battery
        battery: "< 20"
      options:
        type: button
        show_state: true
        icon: mdi:battery-10
    - domain: binary_sensor
      state: "on"
      attributes:
        device_class: battery
      options:
        type: button
        show_state: true
        state_color: false

    - domain: plant
      state: problem
      options:
        type: custom:button-card
        template: plant

    - entity_id: fan.air_purifier
      state: "on"
      options:
        type: custom:button-card
        template: air_purifier

    - entity_id: "sensor.pollen_*_risk"
      state: "*high*" # Matches "anything containing high.
      options:
        type: button
        show_state: true

    - entity_id: binary_sensor.updater
      state: "on"
      options:
        type: button
        show_state: true
        tap_action:
          action: navigate
          navigation_path: /dashboard-systems/hass

    - entity_id: weather.knmi_purmerend
      options:
        type: button
        name: Weer
        show_state: true
        tap_action:
          action: navigate
          navigation_path: /dashboard-buiten/weer
sort:
  method: name
