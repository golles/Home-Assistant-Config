type: custom:auto-entities
show_empty: false
card:
  type: grid
  columns: 3
  square: false
  title: Let op
card_param: cards
filter:
  template: >-
    {%- set data = namespace(entities=[]) -%}

    {% if state_attr("sensor.p2000_dichtbij", "time") %}
      {% if as_timestamp(now()) <= as_timestamp(state_attr("sensor.p2000_dichtbij", "time")) + 7200 %}
        {%- set data.entities = data.entities + [{
          "type": "tile",
          "entity": "sensor.p2000_dichtbij",
          "name": "Dichtbij",
          "icon": "mdi:alert",
          "color": "orange",
          "vertical": true
        }] -%}
      {% endif %}
    {% endif %}

    {% if data.entities | length > 0 %}
      {{ data.entities }}
    {% endif %}
  include:
    # Waste collection
    - domain: sensor
      attributes:
        Wastecollector: purmerend
        Days_until: <= 1
      options:
        type: tile
        show_entity_picture: true
        vertical: true
      not:
        state: unknown

    # Appliances
    - entity_id: "sensor.vaatwasser_status"
      options:
        type: tile
        name: Vaatwasser
        vertical: true
      not:
        state: "/off|unavailable|unknown/"
    - entity_id: "sensor.wasmachine_status"
      options:
        type: tile
        name: Wasmachine
        vertical: true
      not:
        state: "/off|unavailable|unknown/"
    - entity_id: fan.air_purifier
      state: "on"
      options:
        type: tile
        vertical: true

    # Batteries
    - attributes:
        device_class: battery
        battery: "< 15"
      options:
        type: tile
        icon: mdi:battery-10
        vertical: true
        color: red
    - domain: binary_sensor
      state: "on"
      attributes:
        device_class: battery
      options:
        type: tile
        vertical: true
        color: red

    # Weather related warnings
    - entity_id: binary_sensor.stookalert_noord_holland
      state: "on"
      options:
        type: tile
        name: Stookalert
        icon: mdi:alert
        vertical: true
        color: orange
    - entity_id: binary_sensor.knmi_purmerend_waarschuwing
      state: "on"
      options:
        type: tile
        name: KNMI Waarschuwing
        icon: mdi:alert
        vertical: true
        color: orange
    - entity_id: binary_sensor.meteoalarm
      state: "on"
      options:
        type: tile
        name: MeteoAlarm
        icon: mdi:alert
        vertical: true
        color: orange
    - entity_id: "sensor.tomorrow_io_huis_*_pollen_index"
      state: "*high" # Matches "anything containing high.
      options:
        type: tile
        vertical: true
        color: red

    # Modes
    - entity_id: input_boolean.vacation_mode
      state: "on"
      options:
        type: tile
        vertical: true
        color: green

sort:
  method: name
