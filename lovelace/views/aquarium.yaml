title: Aquarium
path: aquarium
icon: mdi:fishbowl-outline
type: sections
sections:
  - type: custom:mushroom-chips-card
    chips:
      - type: template
        tap_action:
          action: navigate
          navigation_path: /lovelace/welkom
        icon: mdi:arrow-left-bold
        content: Overzicht
    layout_options:
      grid_columns: full

  - type: grid
    column_span: 4
    cards:
      - type: heading
        heading: Aquarium
        heading_style: title
        icon: mdi:fishbowl-outline

  - type: grid
    cards:
      - type: heading
        heading: Status
        heading_style: subtitle
      - type: tile
        entity: light.aquarium_licht
        name: Lamp
        state_content:
          - state
          - effect
      - type: tile
        entity: sensor.aquarium_watertemperatuur
        name: Temperatuur

  - type: grid
    cards:
      - type: heading
        heading: Verlichting
        heading_style: subtitle
      - type: tile
        entity: button.aquarium_preset_1
        name: Preset 1
      - type: tile
        entity: button.aquarium_preset_2
        name: Preset 2
      - type: tile
        entity: button.aquarium_preset_3
        name: Preset 3
      - type: tile
        entity: button.aquarium_preset_4
        name: Preset 4

  - type: grid
    cards:
      - type: heading
        heading: Sensoren
        heading_style: subtitle
      - type: tile
        entity: binary_sensor.aquarium_connectiviteit
        name: Status
      - type: tile
        entity: binary_sensor.aquarium_watertemperatuur
        name: Temperatuur
      - type: tile
        entity: binary_sensor.aquarium_pomp_lekkage_water_leak
        name: Pomp lekkage

  - type: grid
    cards:
      - type: heading
        heading: Stroom schakelaars
        heading_style: subtitle
      - type: tile
        entity: switch.aquarium_verlichting_plug
        name: Verlichting
      - type: tile
        entity: switch.aquarium_pomp_plug
        name: Pomp
      - type: tile
        entity: switch.aquarium_verwarming_plug
        name: Verwarming
      - type: tile
        entity: switch.aquarium_luchtpomp_plug
        name: Luchtpomp

  - type: grid
    cards:
      - type: heading
        heading: Tijdschema
        heading_style: subtitle
      - type: custom:apexcharts-card
        graph_span: 1d
        span:
          start: day
        all_series_config:
          stroke_width: 2
          show:
            legend_value: false
            in_header: false
          extend_to: now
          type: line
          curve: straight
          unit: "%"
        apex_config:
          yaxis:
            max: 100
            min: 0
          stroke:
            curve: straight
        now:
          show: true
          label: Nu
          color: red

        section_mode: true
        series:
          - entity: light.aquarium_licht
            name: Red
            color: red
            data_generator: >
              const key = 'red';

              const sch = entity.attributes.schedule || {};

              const dayStart = new Date(start.getFullYear(), start.getMonth(),
              start.getDate(), 0, 0).getTime();

              const toTs = t => { const [h,m] = t.split(':').map(Number); return new
              Date(start.getFullYear(), start.getMonth(), start.getDate(), h,
              m).getTime(); };

              const points = Object.entries(sch).map(([time, vals]) => {
                const ts = toTs(time);
                const base = parseFloat(vals[key] ?? 0);
                const intensity = parseFloat(vals.intensity ?? 0);
                return [ts, base * intensity / 100];
              }).sort((a,b)=>a[0]-b[0]);

              if (points.length === 0) return [[dayStart,0]];

              if (points[0][0] > dayStart) { points.unshift([Math.max(points[0][0]-1000,
              dayStart),0]); points.unshift([dayStart,0]); }

              return points;
          - entity: light.aquarium_licht
            name: Green
            color: green
            data_generator: >
              const key = 'green';

              const sch = entity.attributes.schedule || {};

              const dayStart = new Date(start.getFullYear(), start.getMonth(),
              start.getDate(), 0, 0).getTime();

              const toTs = t => { const [h,m] = t.split(':').map(Number); return new
              Date(start.getFullYear(), start.getMonth(), start.getDate(), h,
              m).getTime(); };

              const points = Object.entries(sch).map(([time, vals]) => {
                const ts = toTs(time);
                const base = parseFloat(vals[key] ?? 0);
                const intensity = parseFloat(vals.intensity ?? 0);
                return [ts, base * intensity / 100];
              }).sort((a,b)=>a[0]-b[0]);

              if (points.length === 0) return [[dayStart,0]];

              if (points[0][0] > dayStart) { points.unshift([Math.max(points[0][0]-1000,
              dayStart),0]); points.unshift([dayStart,0]); }

              return points;
          - entity: light.aquarium_licht
            name: Blue
            color: blue
            data_generator: >
              const key = 'blue';

              const sch = entity.attributes.schedule || {};

              const dayStart = new Date(start.getFullYear(), start.getMonth(),
              start.getDate(), 0, 0).getTime();

              const toTs = t => { const [h,m] = t.split(':').map(Number); return new
              Date(start.getFullYear(), start.getMonth(), start.getDate(), h,
              m).getTime(); };

              const points = Object.entries(sch).map(([time, vals]) => {
                const ts = toTs(time);
                const base = parseFloat(vals[key] ?? 0);
                const intensity = parseFloat(vals.intensity ?? 0);
                return [ts, base * intensity / 100];
              }).sort((a,b)=>a[0]-b[0]);

              if (points.length === 0) return [[dayStart,0]];

              if (points[0][0] > dayStart) { points.unshift([Math.max(points[0][0]-1000,
              dayStart),0]); points.unshift([dayStart,0]); }

              return points;
          - entity: light.aquarium_licht
            name: White
            color: lightgrey
            data_generator: >
              const key = 'white';

              const sch = entity.attributes.schedule || {};

              const dayStart = new Date(start.getFullYear(), start.getMonth(),
              start.getDate(), 0, 0).getTime();

              const toTs = t => { const [h,m] = t.split(':').map(Number); return new
              Date(start.getFullYear(), start.getMonth(), start.getDate(), h,
              m).getTime(); };

              const points = Object.entries(sch).map(([time, vals]) => {
                const ts = toTs(time);
                const base = parseFloat(vals[key] ?? 0);
                const intensity = parseFloat(vals.intensity ?? 0);
                return [ts, base * intensity / 100];
              }).sort((a,b)=>a[0]-b[0]);

              if (points.length === 0) return [[dayStart,0]];

              if (points[0][0] > dayStart) { points.unshift([Math.max(points[0][0]-1000,
              dayStart),0]); points.unshift([dayStart,0]); }

              return points;

  - type: grid
    column_span: 4
    cards:
      - type: heading
        heading: Statistiek
        heading_style: subtitle

      - type: custom:apexcharts-card
        graph_span: 14d
        span:
          start: day
          offset: "-13d"
        all_series_config:
          stroke_width: 2
        section_mode: true
        grid_options:
          columns: full
        yaxis:
          - decimals: 2
            apex_config:
              title:
                text: Verbruik (kWh)
        apex_config:
          tooltip:
            x:
              format: d MMMM yyyy
            y:
              formatter: |
                EVAL:function(value, { series, seriesIndex, dataPointIndex, w }) {
                  if (value === null) {
                    return "0 kWh";
                  }
                  return value.toFixed(2) + " kWh";
                }
        series:
          - entity: sensor.aquarium_pomp_plug_energy
            name: Pomp
            color: "#4269d0"
            opacity: 0.5
            type: column
            group_by:
              duration: 1d
              func: diff
          - entity: sensor.aquarium_verlichting_plug_energy
            name: Verlichting
            color: "#f4bd4a"
            opacity: 0.5
            type: column
            group_by:
              duration: 1d
              func: diff
          - entity: sensor.aquarium_verwarming_plug_energy
            name: Verwarming
            color: "#ff725c"
            opacity: 0.5
            type: column
            group_by:
              duration: 1d
              func: diff
          - entity: sensor.aquarium_luchtpomp_plug_energy
            name: Luchtpomp
            color: "#4ac98b"
            opacity: 0.5
            type: column
            group_by:
              duration: 1d
              func: diff

      - type: custom:apexcharts-card
        graph_span: 14d
        span:
          start: day
          offset: "-13d"
        all_series_config:
          stroke_width: 2
        section_mode: true
        grid_options:
          columns: full
        yaxis:
          - decimals: 1
            min: "|-1|"
            max: "|+1|"
            apex_config:
              title:
                text: Temperatuur (Â°C)
        series:
          - entity: sensor.aquarium_watertemperatuur
            name: Aquarium temperatuur
            color: "#4269d0"
            opacity: 0.5
            fill_raw: last
            group_by:
              func: avg
              duration: 30min
          - entity: sensor.woonkamer_temperatuur
            name: Kamer temperatuur
            color: "#ff725c"
            opacity: 0.5
            fill_raw: last
            group_by:
              func: avg
              duration: 30min
